<!-- https://squidfunk.github.io/mkdocs-material/customization/#overriding-blocks -->


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Flexibility Information System">
      
      
      
        <link rel="canonical" href="https://elhub.github.io/flex-information-system/technical/auth/">
      
      
        <link rel="prev" href="../api-design/">
      
      
        <link rel="next" href="../identifiers/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Auth - Flexibility Information System Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../style.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#auth" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
    <span>This documentation is work-in-progress and part of the <a href="https://www.euroflex.no/">EuroFlex research project</a>.</span>
    <span>Read more about <a href="/flex-information-system/privacy">privacy and cookies</a></span>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Flexibility Information System Documentation" class="md-header__button md-logo" aria-label="Flexibility Information System Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flexibility Information System Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Auth
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flexibility Information System Documentation" class="md-nav__button md-logo" aria-label="Flexibility Information System Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Flexibility Information System Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../privacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Privacy and Cookies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/end-user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End Users
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/grid-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grid Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/ready-for-market/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ready for market
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/suspension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Suspension
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/time-series/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Series
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/test-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../processes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Processes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Processes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/controllable-unit-lookup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CU Lookup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/controllable-unit-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CU Registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/controllable-unit-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CU Update
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/revocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SP Contract Revocation and Termination
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/service-provider-product-application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SP Product Application and Qualification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/service-provider-registration-and-approval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SP Registration and Approval
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/service-provider-switching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SP Switching Initiated by New SP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/service-providing-group-product-application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPG Product Application and Prequalification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/service-providing-group-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPG Registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processes/system-operator-product-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SO Product Registration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../resources/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/accounting_point/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounting Point
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/accounting_point_balance_responsible_party/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounting Point Balance Responsible Party
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/accounting_point_energy_supplier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounting Point Energy Supplier
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/controllable_unit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controllable Unit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/controllable_unit_service_provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controllable Unit Service Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/entity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/entity_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entity Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/identity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/notice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/notification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/party/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Party
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/party_membership/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Party Membership
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/product_type/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Type
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_provider_product_application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Provider Product Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_provider_product_application_comment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Provider Product Application Comment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_providing_group/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Providing Group
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_providing_group_grid_prequalification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Providing Group Grid Prequalification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_providing_group_membership/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Providing Group Membership
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/service_providing_group_product_application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Providing Group Product Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/system_operator_product_type/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Operator Product Type
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/technical_resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical Resource
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Technical
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Auth
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Auth
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    <span class="md-ellipsis">
      Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth-20-and-openid-connect-standards" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0 and OpenID Connect standards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-model" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identity" class="md-nav__link">
    <span class="md-ellipsis">
      Identity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-individuals-and-organisations" class="md-nav__link">
    <span class="md-ellipsis">
      Entity - individuals and organisations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#party-market-actors" class="md-nav__link">
    <span class="md-ellipsis">
      Party - market actors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Party - market actors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#balance-responsible-party" class="md-nav__link">
    <span class="md-ellipsis">
      Balance Responsible Party
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-user" class="md-nav__link">
    <span class="md-ellipsis">
      End User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#energy-supplier" class="md-nav__link">
    <span class="md-ellipsis">
      Energy Supplier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flexibility-information-system-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Flexibility Information System Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Market Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organisation" class="md-nav__link">
    <span class="md-ellipsis">
      Organisation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-operator" class="md-nav__link">
    <span class="md-ellipsis">
      System Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Service Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party" class="md-nav__link">
    <span class="md-ellipsis">
      Third Party
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    <span class="md-ellipsis">
      Roles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anonymous-users" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous users
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openid-connect" class="md-nav__link">
    <span class="md-ellipsis">
      OpenID Connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Client credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-bearer" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Bearer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Token exchange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-client-credentials-and-token-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Example - client credentials and token exchange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Scopes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verb" class="md-nav__link">
    <span class="md-ellipsis">
      Verb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module" class="md-nav__link">
    <span class="md-ellipsis">
      Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource" class="md-nav__link">
    <span class="md-ellipsis">
      Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Scope examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#party-type-check" class="md-nav__link">
    <span class="md-ellipsis">
      Party type check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-level-authorization-fla" class="md-nav__link">
    <span class="md-ellipsis">
      Field Level Authorization (FLA)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-level-authorization-rla" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Level Authorization (RLA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Level Authorization (RLA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-dependent-rla" class="md-nav__link">
    <span class="md-ellipsis">
      Time-dependent RLA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time-dependent RLA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-latest-visible-record" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Latest visible record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-as-of-query" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: As-of query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-creation-and-access-control-management" class="md-nav__link">
    <span class="md-ellipsis">
      User creation and access control management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User creation and access control management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autonomous-access-control-management" class="md-nav__link">
    <span class="md-ellipsis">
      Autonomous access control management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence-of-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Sequence of actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-information-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      User information endpoint
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identifiers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identifiers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openapi-schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structure of JSON schemas in the OpenAPI documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource-synchronisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource synchronisation from external sources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time-series-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Series Service Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    <span class="md-ellipsis">
      Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth-20-and-openid-connect-standards" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0 and OpenID Connect standards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-model" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identity" class="md-nav__link">
    <span class="md-ellipsis">
      Identity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-individuals-and-organisations" class="md-nav__link">
    <span class="md-ellipsis">
      Entity - individuals and organisations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#party-market-actors" class="md-nav__link">
    <span class="md-ellipsis">
      Party - market actors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Party - market actors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#balance-responsible-party" class="md-nav__link">
    <span class="md-ellipsis">
      Balance Responsible Party
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-user" class="md-nav__link">
    <span class="md-ellipsis">
      End User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#energy-supplier" class="md-nav__link">
    <span class="md-ellipsis">
      Energy Supplier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flexibility-information-system-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Flexibility Information System Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Market Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organisation" class="md-nav__link">
    <span class="md-ellipsis">
      Organisation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-operator" class="md-nav__link">
    <span class="md-ellipsis">
      System Operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Service Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party" class="md-nav__link">
    <span class="md-ellipsis">
      Third Party
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    <span class="md-ellipsis">
      Roles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anonymous-users" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous users
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openid-connect" class="md-nav__link">
    <span class="md-ellipsis">
      OpenID Connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Client credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-bearer" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Bearer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Token exchange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-client-credentials-and-token-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Example - client credentials and token exchange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Scopes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verb" class="md-nav__link">
    <span class="md-ellipsis">
      Verb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module" class="md-nav__link">
    <span class="md-ellipsis">
      Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource" class="md-nav__link">
    <span class="md-ellipsis">
      Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Scope examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#party-type-check" class="md-nav__link">
    <span class="md-ellipsis">
      Party type check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-level-authorization-fla" class="md-nav__link">
    <span class="md-ellipsis">
      Field Level Authorization (FLA)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-level-authorization-rla" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Level Authorization (RLA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Level Authorization (RLA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-dependent-rla" class="md-nav__link">
    <span class="md-ellipsis">
      Time-dependent RLA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time-dependent RLA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-latest-visible-record" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Latest visible record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-as-of-query" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: As-of query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-creation-and-access-control-management" class="md-nav__link">
    <span class="md-ellipsis">
      User creation and access control management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User creation and access control management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autonomous-access-control-management" class="md-nav__link">
    <span class="md-ellipsis">
      Autonomous access control management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence-of-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Sequence of actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-information-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      User information endpoint
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="auth">Auth</h1>
<p>This document describes the authentication and authorization model, principles
and concepts we are following in the Flexibility Information System. It is a
quite comprehensive document and contains alot of nitty-gritty details - even
about implementation. We are using it both as a design document and
documentation. You can use it as a reference and for understanding how we are
doing things.</p>
<p>The document assumes that you have some basic knowledge around the topic, such
as the distiction between authentication and authorization, but we will try to
add external links to relevant resources where appropriate (like we just did 😉).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We use <em>auth</em> as a short form for <em>authentication and authorization</em> in this
document.</p>
</div>
<h2 id="overview">Overview</h2>
<p>We think of auth as a layered system, where each layer has a specific purpose
and responsibility. The layers are independent of each other and a request is
required to pass all the layers to be allowed access. The following diagram
shows the layers we have in our model.</p>
<p><img alt="Auth Layers" src="../../diagrams/auth_layers.drawio.png" /></p>
<p>The layers in the auth model are there to protect our resources. These resources
take the form of data or remote procedure calls (RPCs) in our APIs. You can
think of a resource as a path in our API, e.g. <code>/api/v0/controllable_unit/</code>.
Authorization protects what actions (create, read, update, delete, call) the
user can do on the resources.</p>
<ol>
<li><strong>Session or token validation</strong> - This is how we authenticate the user. Once
   authentication is done we know the entity, party and scopes of the user. If
   there is no session or token the user enters the system as an anonymous user
   with read access.</li>
<li><strong>Scope check</strong> - Empty scope means no access. The scope check validates actions
   on resources, e.g. does the user have the scope to do update on this
   resource.</li>
<li><strong>Party type check</strong> - Actions on some resources might only be accessible for
   certain party types, like the <code>Flexibility Information System Operator</code> or
   <code>System Operator</code>. For these resources we have an explicit party type check
   for additional security, e.g. is the party type of the user allowed to do
   call this resource. We typically use this on RPC resources.</li>
<li><strong>Field Level Authorization</strong> - FLA controls access for the combination of
   party type, action and fields, e.g. can this party type update these fields on
   this resource.</li>
<li><strong>Resource Level Authorization</strong> - RLA controls access for the specific party
   and resource, e.g. can this party delete this resource.</li>
</ol>
<p>Read more details about the layers further down in this document.</p>
<h2 id="actions">Actions</h2>
<p>When we talk about authorization we usually talk about performing "actions" on
resources or fields. The table below shows the actions and their corresponding
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">HTTP methods</a> and
<a href="https://www.postgresql.org/docs/15/sql-grant.html">database grants</a>.</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>HTTP verb</th>
<th>Database grant</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>C</strong>reate</td>
<td>POST</td>
<td>INSERT</td>
<td></td>
</tr>
<tr>
<td><strong>R</strong>ead</td>
<td>GET</td>
<td>SELECT</td>
<td></td>
</tr>
<tr>
<td><strong>U</strong>pdate</td>
<td>PATCH</td>
<td>UPDATE</td>
<td></td>
</tr>
<tr>
<td><strong>D</strong>elete</td>
<td>DELETE</td>
<td>DELETE</td>
<td></td>
</tr>
<tr>
<td><strong>C</strong>all</td>
<td>POST</td>
<td>EXECUTE</td>
<td>Used for RPC type endpoints.</td>
</tr>
</tbody>
</table>
<p>We do not model <code>List</code> as a specific action even tho it is a verb - someting a
user can do - on the <a href="../api-design/">API</a>. It is covered by <code>Read</code>.</p>
<h2 id="oauth-20-and-openid-connect-standards">OAuth 2.0 and OpenID Connect standards</h2>
<p>We are relying on the patterns and flows established as part of multiple RFCs
related to OAuth 2.0 as well as
<a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a>.
Relevant RFCs are listed below, but you can also check the
<a href="https://www.oauth.com/oauth2-servers/map-oauth-2-0-specs/">map of OAuth 2.0 specs from Okta</a>.</p>
<ul>
<li><a href="https://www.rfc-editor.org/rfc/rfc6749">RFC6749 - The OAuth 2.0 Authorization Framework</a></li>
<li><a href="https://www.rfc-editor.org/rfc/rfc6750">RFC6750 - The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7636">RFC7636 - Proof Key for Code Exchange by OAuth Public Clients</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7523">RFC7523 - JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8693">RFC8693 - OAuth 2.0 Token Exchange</a></li>
</ul>
<p>The implementation
follows only parts of these standards, but we are trying to comply with the
specification for the parts we actually implement.</p>
<p>We are also relying heavily on the JOSE (Javascript Object Signing and Encryption)
<a href="https://datatracker.ietf.org/wg/jose/about/">suite of specifications</a>.</p>
<div class="admonition note">
<p class="admonition-title">Distinct API for authentication</p>
<p>Note that authentication and the rest of the Flexibility Information System
work as two <em>separate</em> services, and as such, are exposed through <em>distinct</em>
APIs. The endpoints can be reached by using the <code>/api</code> or
<code>/auth/</code> prefixes in the URL used to access the Flexibility Information
System APIs. In the rest of this page, we use the terms <em>main API</em> and <em>auth API</em>
to distinguish these distinct roots of API endpoints.</p>
</div>
<h2 id="authentication-model">Authentication model</h2>
<p>In this section, we describe the authentication model in the Flexibility
Information System.</p>
<h3 id="identity">Identity</h3>
<p>Any system or person interacting with the Flexibility Information System will
always be authenticated as a legal og natural <em>entity</em>, possibly assuming the
role of a market <em>party</em>. The entity and party together make up the <em>identity</em>
of the user.</p>
<p>The entity has very little functionality available in the system, most
functionality will be available after assuming a <em>party</em>. The identity of the
user is then the combination of the entity and the party they are acting as. As
a result, in order to interact properly with the Flexibility Information System,
an entity must assume a party.</p>
<p>Inspiration for this step is taken from <a href="https://info.altinn.no/en/">Altinn</a>,
where one is presented with a list of parties upon login. The Elhub portal also
has the same type of logical mechanism.</p>
<p><img alt="Altinn select party" src="../../assets/altinn-choose-party.png" />.</p>
<p>The concept is also inspired by <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AWS AssumeRole</a>.</p>
<p>Assuming a party is done using <a href="#token-exchange">Token Exchange</a> or directly in
authentication using <a href="#jwt-bearer">JWT Bearer</a> grant. To assume a party, the
entity must be a member of the party.</p>
<h3 id="entity-individuals-and-organisations">Entity - individuals and organisations</h3>
<p>The <em>entity</em> is the natural or legal person using the system. This is the "raw"
identity of the user when it enters the system.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Natural_person">Natural entities</a> are
  <em>individuals</em> identified by their national identity number (fødselsnummer) or
  D-number.</li>
<li><a href="https://en.wikipedia.org/wiki/Legal_person">Legal entities</a> are
  <em>organisations</em> identified by their organisation number (organisasjonsnummer).</li>
</ul>
<p>In a production setting, the identity of the entity will be established through
mechanisms such as IDPorten, Maskinporten or enterprise certificates.</p>
<h3 id="party-market-actors">Party - market actors</h3>
<p>This is the market party like a system operator or service provider. Parties in
the European energy sector are typically identified by a GLN or <code>EIC-X</code>. After
being authenticated as an entity, the user can assume a party to
interact with the system.</p>
<p>We have two extra party types in addition to the other market actors: end users
and organisations.
An end user is either
<a href="https://www.nve.no/reguleringsmyndigheten/regulering/kraftmarkedet/sluttbrukermarkedet/">a person or an organisation</a>.
The organisation party is a way for the user to have access to a special role to
perform modifications on their own organisation entity.
They can for instance give total or partial (via delegation mechanisms) access
to what the entity owns and manages, to people from the same company.</p>
<p>We have the following party types in the Flexibility Information System:</p>
<table>
<thead>
<tr>
<th>Abbreviation</th>
<th>Code</th>
<th>Name</th>
<th>Norwegian name</th>
</tr>
</thead>
<tbody>
<tr>
<td>BRP</td>
<td>balance_responsible_party</td>
<td>Balance Responsible Party</td>
<td><em>Balanseansvarlig</em></td>
</tr>
<tr>
<td>EU</td>
<td>end_user</td>
<td>End User</td>
<td><em>Sluttbruker</em></td>
</tr>
<tr>
<td>ES</td>
<td>energy_supplier</td>
<td>Energy Supplier</td>
<td><em>Kraftleverandør</em></td>
</tr>
<tr>
<td>FISO</td>
<td>flexibility_information_system_operator</td>
<td>Flexibility Information System Operator</td>
<td><em>Fleksibilitetsinformasjonssystem Operatør</em></td>
</tr>
<tr>
<td>MO</td>
<td>market_operator</td>
<td>Market Operator</td>
<td><em>Markedoperatør</em></td>
</tr>
<tr>
<td>ORG</td>
<td>organisation</td>
<td>Organisation</td>
<td><em>Organisasjon</em></td>
</tr>
<tr>
<td>SO</td>
<td>system_operator</td>
<td>System Operator</td>
<td><em>Systemoperatør</em></td>
</tr>
<tr>
<td>SP</td>
<td>service_provider</td>
<td>Service Provider</td>
<td><em>Tjenesteleverandør</em></td>
</tr>
<tr>
<td>TP</td>
<td>third_party</td>
<td>Third Party</td>
<td><em>Tredjepart</em></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Common policies</p>
<p>In addition to these we also write policies and grant access that are common
for all authenticated party types. This is referred to as <code>Common</code>,
abbreviated as <code>COM</code>. All party types inherit the policies from <code>Common</code>.</p>
</div>
<p>The following sub-sections provides a brief description of each party type.</p>
<h4 id="balance-responsible-party">Balance Responsible Party</h4>
<p>A party responsible for its imbalances.</p>
<p>Based on: <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A02017R2195-20220619">Consolidated text: Commission Regulation (EU) 2017/2195 - Art.2 Definitions</a>.</p>
<h4 id="end-user">End User</h4>
<p>Synonyms:</p>
<ul>
<li><em>Final Customer</em> (<em>Sluttkunde</em>)</li>
<li><em>Flexible Customer</em></li>
<li><em>System User</em></li>
</ul>
<p>The entity at the lower end of the chain, willing to make their own technical
resources available on the flexibility market.</p>
<h4 id="energy-supplier">Energy Supplier</h4>
<p>Synonyms:</p>
<ul>
<li><em>Balance Supplier</em></li>
<li><em>Supplier</em></li>
</ul>
<p>A party delivering to or taking energy from a party connected to the grid at an
accounting point.</p>
<h4 id="flexibility-information-system-operator">Flexibility Information System Operator</h4>
<p>Synonyms:</p>
<ul>
<li><em>Flexibility Register Operator</em></li>
</ul>
<p>We use this as an administrator role for the Flexibility Information System, as
a last resort tool to have full authorisation on the system or perform special
operations.</p>
<h4 id="market-operator">Market Operator</h4>
<p>Sub-types:</p>
<ul>
<li><em>Local Market Operator</em></li>
<li><em>Balancing Market Operator</em></li>
</ul>
<p>A party that provides a service whereby the offers to sell energy are matched
with bids to buy energy.</p>
<p>Based on: <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A02019R0943-20220623">Consolidated text: Regulation (EU) 2019/943</a>.</p>
<h4 id="organisation">Organisation</h4>
<p>This is not a market party as such but a party that represents the organisation
entity.</p>
<h4 id="system-operator">System Operator</h4>
<p>Synonyms:</p>
<ul>
<li><em>Grid Owner</em></li>
</ul>
<p>Sub-types:</p>
<ul>
<li><em>Distribution System Operator</em></li>
<li><em>Transmission System Operator</em></li>
<li><em>Connecting System Operator</em></li>
<li><em>Requesting System Operator</em></li>
<li><em>Procuring System Operator</em></li>
<li><em>Impacted System Operator</em></li>
</ul>
<p>A party responsible for operating, ensuring the maintenance of and, if
necessary, developing the system in a given area and, where applicable, its
interconnections with other systems, and for ensuring the long-term ability of
the system to meet reasonable demands for the distribution or transmission of
energy.</p>
<p>Based on: <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A02019L0944-20220623">Consolidated text: Directive (EU) 2019/944</a>.</p>
<h4 id="service-provider">Service Provider</h4>
<p>Sub-types:</p>
<ul>
<li><em>Balancing Service Provider</em></li>
<li><em>Flexibility Service Provider</em></li>
</ul>
<p>A party that offers local or balancing services to other parties in the market,
after having successfully passed a qualification process.</p>
<h4 id="third-party">Third Party</h4>
<p>A party that does not have an actual responsibility in the value chain, but
<em>can be</em> delegated authority to, <em>e.g.</em>, perform tasks or access data.</p>
<h3 id="roles">Roles</h3>
<p>Parties in the Energy sector act in different "roles". For some examples, see
the
<a href="https://elhub.no/aktorer-og-markedsstruktur/aktorenes-roller/rollemodell/">Elhub role model</a>.
This level is mostly used for delegation. As of now, this level is <strong>NOT</strong> part of
the authentication or authorization model.</p>
<div class="admonition note">
<p class="admonition-title">The word 'role' can be seen in the system</p>
<p>Our database and API service does sometime refer to something called
"roles". This is just how we model parties and entities in the system and is
not related to the conceptual authentication or authorization model as
described here.</p>
</div>
<h3 id="anonymous-users">Anonymous users</h3>
<p>Some data (like party lists) and actions (such as login) will be available for
un-authenticated users. We refer to these as <code>Anonymous</code>, abbreviated as <code>ANON</code>.</p>
<p>An anonymous user has the following default scopes:</p>
<ul>
<li><code>read:data</code> - to be able to access open data (if any)</li>
<li><code>use:auth</code> - to be able to log in etc</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Policy inheritance</p>
<p>RLA policies for <code>Anonymous</code>/<code>ANON</code> are inherited by <em>all authenticated users</em>.</p>
</div>
<h2 id="authentication-methods">Authentication methods</h2>
<p>Authentication is the process of establishing the "raw" identity of the user.
For us, this means identifying the <em>entity</em>, i.e. the individual or organisation
using the system. We provide different ways of authentication, depending on how
you want to interact with the system.</p>
<p>Individuals what want to log into the portal will log in using the
<code>OpenID Connect</code> protocol with an identity provider. In a production setting the
identity provider will be IDPorten.</p>
<p>Entities that want to use the API will have to create and attach clients to
their entity resource in the system. Creating a client generates a unique
identifier and allows setting a password and/or a public key associated to this
client. From there, users have two ways of authenticating.</p>
<ul>
<li><code>JWT Bearer</code> - The entity uploads a public key to one of its clients and uses
  a self-signed JWT Authorization grant to authenticate.</li>
<li><code>Client Credentials</code> - The entity uses a client_id and client_secret to
  authenticate. The client_id is the UUID of one of the clients added by the
  entity in the system, and client_secret is basically a password that must be
  set on this client.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Possible future use of enterprise certificates</p>
<p>We are considering the use of enterprise certificates and/or Maskinporten in
a production setting.</p>
</div>
<h3 id="openid-connect">OpenID Connect</h3>
<p>A regular user in the portal will be authenticated via a OpenID Connect
compatible provider. We believe that IDPorten is the most likely candidate for a
production system. In test we are using Oracle Cloud Identity and
Access Management (IAM).</p>
<p>The OpenID connect flow is based on redirects between the portal and the Idenity
provider, and as part of the process, the Flexibility Information System will
obtain the identity of the user from the Identity provider and issue an access
token for the portal.</p>
<h3 id="client-credentials">Client credentials</h3>
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>This is a temporary solution that will be removed in later versions of the
FIS. Use the <code>JWT Bearer</code> method instead.</p>
</div>
<p>To use this method, first log in to the portal and add a new client to the
entity. Then, write down the generated Client ID on the created client, because
you will need it to log in, and set the Client Secret on the client. This should
be a strong password. Consider generating a random password using some kind of
online generator.</p>
<p>Once Client Secret is set in the portal, the connection is established through
basic authentication on the auth API's <code>/token</code> endpoint, using the
<a href="https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/">client_credentials</a>
<code>grant_type</code> with
<a href="https://datatracker.ietf.org/doc/html/rfc6749#section-2.3.1">Client Password</a>,
in a URL-encoded body.</p>
<p>Set <code>Content-Type</code> header as <code>application/x-www-form-urlencoded</code>.</p>
<p>Example body:</p>
<div class="highlight"><pre><span></span><code>grant_type=client_credentials&amp;client_id=&lt;client_id&gt;&amp;client_secret=&lt;client_secret&gt;
</code></pre></div>
<p>The result is a JWT access token for the entity that can be used to access the API.</p>
<h3 id="jwt-bearer">JWT Bearer</h3>
<p>This is the preferred method for authenticating towards the API. The method
uses
<a href="https://datatracker.ietf.org/doc/html/rfc7523#section-2.1">JWTs as authorization grants</a>
as defined by RFC7523. This the same method as <a href="https://docs.digdir.no/docs/Maskinporten/maskinporten_auth_server-to-server-oauth2">used by Maskinporten</a>.</p>
<p>To authenticate, the client must send a request with <code>Content-Type</code> header as
<code>application/x-www-form-urlencoded</code> and a body similar to the following:</p>
<div class="highlight"><pre><span></span><code>grant_type: urn:ietf:params:oauth:grant-type:jwt-bearer&amp;assertion=&lt;authorization grant JWT&gt;
</code></pre></div>
<p>The magic is in the assertion JWT. Use the following payload.</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Name</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td>Audience</td>
<td>The URL of the token endpoint.</td>
<td><code>https://flex-test.elhub.no/auth/v0/</code></td>
</tr>
<tr>
<td><code>exp</code></td>
<td>Expiration Time</td>
<td>The expiration time of the JWT. Maximum 120 seconds after <code>iat</code>.</td>
<td></td>
</tr>
<tr>
<td><code>iat</code></td>
<td>Issued At</td>
<td>The time the JWT was issued. Only tokens with <code>iat</code> within 10 seconds of server time will be accepted.</td>
<td></td>
</tr>
<tr>
<td><code>iss</code></td>
<td>Issuer</td>
<td>The issuer of the token on the format. <code>no:entity:uuid:&lt;client_id&gt;</code>. <code>client_id</code> is the UUID of the client whose key is used to sign the token.</td>
<td><code>no:entity:uuid:2fc014f2-e9b4-41d4-ad6b-c360b8ee6229</code></td>
</tr>
<tr>
<td><code>jti</code></td>
<td>JWT</td>
<td>A unique identifier for the JWT. For (future) protection against replay attacks.</td>
<td></td>
</tr>
<tr>
<td><code>sub</code></td>
<td>Subject</td>
<td>Optional. Use if the client wants to assume party as part of the request. Format <code>no:entity:&lt;id_type&gt;:&lt;id&gt;</code>. <code>id_type</code> is the party's <code>business_id_type</code>.</td>
<td><code>no:party:gln:1234567890123</code></td>
</tr>
</tbody>
</table>
<p>The JWT must be signed by the entity client's RSA private key. The public key
must be uploaded to the client in the portal prior to making the request. An
example of how to generate a key pair is shown below. Upload the contents of the
file <code>.flex.pub.pem</code> in the portal.</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>.flex.key.pem<span class="w"> </span><span class="m">3072</span>
openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>.flex.key.pem<span class="w"> </span>-pubout<span class="w"> </span>-out<span class="w"> </span>.flex.pub.pem
</code></pre></div>
<p>How to sign a JWT using the private key depends on your programming
language/system of choice. Here are a few examples/guides:</p>
<ul>
<li>Python - <a href="https://pyjwt.readthedocs.io/en/stable/usage.html#encoding-decoding-tokens-with-rs256-rsa">PyJWT</a></li>
<li>Bash - See this <a href="https://gist.github.com/shu-yusa/213901a5a0902de5ad3f62a61036f4ce?permalink_comment_id=4263484#gistcomment-4263484">gist</a></li>
<li>Go - <a href="https://github.com/lestrrat-go/jwx/blob/develop/v3/docs/02-jws.md#verification-using-a-jwks">jwx</a></li>
</ul>
<p>The response from the endpoint will be a JWT access token that can be used to
access the API.</p>
<h3 id="token-exchange">Token exchange</h3>
<p>If the user has logged in via client credentials or OpenID connect, the user can
assume a party by doing a
<a href="https://datatracker.ietf.org/doc/html/rfc8693">OAuth 2.0 Token Exchange</a> that
lets an entity "impersonate" a party with the returned token. This is done by
calling the same <code>/token</code> endpoint, this time with the <code>grant_type</code>
<code>urn:ietf:params:oauth:grant-type:token-exchange</code>.</p>
<p>RFC8693 does <em>not</em> cover the case where the client that does token exchange
doesn't have a valid token for the party it wants to impersonate. The spec is
mostly covering use-cases of backends calling other backends, but is flexible
enough to fit our needs.</p>
<div class="admonition quote">
<p class="admonition-title">RFC8693</p>
<p>Additional profiles may provide more detailed requirements around the specific
nature of the parties and trust involved, such as <strong>whether signing and/or
encryption of tokens is needed</strong> or if proof-of-possession-style tokens will be
required or issued. However, <strong>such details will often be policy decisions made
with respect to the specific needs of individual deployments</strong> and will be
configured or implemented accordingly.</p>
</div>
<p>Other systems have met this gap by loosely implementing the RFC, e.g. by
<a href="https://zitadel.com/docs/guides/integrate/token-exchange#impersonation-by-user-id-example">using a custom token type</a>
or adding
<a href="https://www.keycloak.org/docs/23.0.2/securing_apps/#form-parameters">additional form parameters</a>.
We do it by using the access token obtained in step 1 as the <code>actor_token</code>.
Instead of using another token (<em>i.e.</em>, <code>subject_token</code>) to specify the party
the user wants to assume, we just expect the party ID in an additional <code>scope</code>
parameter in the URL-encoded body of the request.</p>
<div class="highlight"><pre><span></span><code>grant_type=urn:ietf:params:oauth:grant-type:token-exchange
&amp;actor_token=&lt;token from step 1&gt;&amp;
&amp;actor_token_type=urn:ietf:params:oauth:token-type:jwt
&amp;scope=assume:party:&lt;desired_party_id&gt;
</code></pre></div>
<p>The response from the endpoint will be a JWT access token that can be used to
access the API.</p>
<h3 id="example-client-credentials-and-token-exchange">Example - client credentials and token exchange</h3>
<p>Below is an example of realistic login sequence:</p>
<ul>
<li>a user logs in as an entity by giving their credentials in the first call to
  the <code>/token</code> endpoint;</li>
<li>they now have sufficient authorisation to read information about themselves,
  including which parties they are allowed to assume;</li>
<li>they ask for a token exchange in the second call to the <code>/token</code> endpoint,
  in order to assume one of the possible parties.</li>
</ul>
<p><img alt="Login Sequence" src="../../diagrams/login_sequence.png" /></p>
<h2 id="authorization">Authorization</h2>
<p>We are providing a <a href="../api-design/">resource-oriented main API</a>. Authorization is
understood as allowing a user access to do an action on a resource or its field.</p>
<p>Our authorization model is based on a deny-by-default principle. This means that
authorization is denied unless explicitly allowed. We then allow certain
<em>actions</em> on <em>resource</em> or <em>field</em> level for a specific <em>party type</em>. The caller
must also have the required <em>scope</em> to perform the action.</p>
<p>You can think of a resource collection as a table. Each rows is a resource. Each
column is a field. We then specify Field Level and Resource Level Authorization
to give access to these resources.</p>
<p>The following examples shows a collection of resources <code>1</code>-<code>5</code>. The resources
have the fields <code>ID</code>, <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code> and <code>E</code>. The colored boxes are read
(green) and update (yellow) policies for <em>one party type</em>. Dotted lines are
field level policies while solid lines are resource level policies.</p>
<p>There are three field level policies that allows read
access to all fields except <code>A</code> and update access to only <code>D</code>.</p>
<p>There are two resource level policies that allows read
access to resources <code>3</code>, <code>4</code> and <code>5</code>, and update access to only <code>5</code>.</p>
<p>Together, these policies allow the party type to read all fields except <code>A</code> of resources
<code>3</code>, <code>4</code> and <code>5</code>, and update only field <code>D</code> of resource <code>5</code>.</p>
<p>In addition to this, the user must have the required scope to perform the action.</p>
<p><img alt="Resource and Field Level Authorization" src="../../diagrams/auth-table.drawio.png" /></p>
<p>More information about the policies and their implementation can be found in the
following sections.</p>
<h3 id="scopes">Scopes</h3>
<p>Every combination of resource and action has a required scope. When a user makes
a request, the system will check that the session or token has that
scope. The requester can have multiple scopes. No scopes means no
access.</p>
<p>In our system, entities are made <em>members</em> of parties to allow them to assume
the parties and act on behalf of them. The party membership is restricted with a
list of scopes. This allows fine-tuning the access control when the entity
assumes the party. When the user authenticates and assumes a party, the
session/token will have the scopes of the party membership.</p>
<p>The purpose of this is e.g. to allow one person to be able to read data in the
system on behalf of a party, while another person can both read and write data.
This fits with the least privilege principle, where we try to give the user the
least amount of access.</p>
<p>A scope shows what the user can do to a specific resource. It is a
colon-separated string on the following format:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">verb</span><span class="p">&gt;</span>:<span class="p">&lt;</span><span class="nt">module</span><span class="p">&gt;</span>[:<span class="p">&lt;</span><span class="nt">resource</span><span class="p">&gt;</span>]...
</code></pre></div>
<p>..and can be read as</p>
<blockquote>
<p>The user can <code>&lt;verb&gt;</code> <code>&lt;resource&gt;</code> in <code>&lt;module&gt;</code>.</p>
</blockquote>
<p>Verb is the privilege or access level. Module and resource typically describe
the <em>asset</em> or <em>path</em> that is being protected are defined below. Resource is
optional and if omitted then it means "all resources".</p>
<h4 id="verb">Verb</h4>
<p>A verb specifies the type of access. The verbs are defined by the actions they
allow on the resource.</p>
<table>
<thead>
<tr>
<th>Verb</th>
<th>Description</th>
<th>Action(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>read</code></td>
<td>Read-only access</td>
<td>Read</td>
</tr>
<tr>
<td><code>use</code></td>
<td><code>read</code> plus calling RPCs (e.g. lookuo)</td>
<td>Read, Call</td>
</tr>
<tr>
<td><code>manage</code></td>
<td>Full access. <code>use</code> plus changing data</td>
<td>Create, Read, Update, Delete, Call</td>
</tr>
</tbody>
</table>
<p>Since the access increases with <code>read</code> &gt; <code>use</code> &gt; <code>manage</code>, there is also
implicit inheritance. This e.g. means that a user with the <code>use</code> verb implicitly
has the <code>read</code> privilege.</p>
<h4 id="module">Module</h4>
<p>A module is a logical grouping of resources. The currently defined modules are.</p>
<ul>
<li><code>data</code> - This is the data API at <code>/api/</code>, for resources such as controllable
  units, service providing groups, etc.</li>
<li><code>auth</code> - This is the module for auth at <code>/auth/</code>.</li>
</ul>
<h4 id="resource">Resource</h4>
<p>The resource part of the scope is used to make sub-scopes within a module. It is
optional and not yet implemented for clients. When omitted, the scope includes
everything in a the module.</p>
<p>The three dots <code>...</code> in the format above means that resources can be nested, to
create sub-scopes.</p>
<p>Each path on our API has a required scope, and every request is checked to see
that the client has a matching scope.</p>
<h4 id="scope-examples">Scope examples</h4>
<p>The following are a few example scopes.</p>
<ul>
<li>
<p><code>GET /api/v0/controllable_unit/</code> requires <code>read:data:controllable_unit</code>. It is
  also covered by e.g. <code>read:data</code> and <code>use:data</code> but not
  <code>manage:data:technical_resource</code>.</p>
</li>
<li>
<p><code>POST /api/v0/controllable_unit/lookup</code> requires <code>use:data:controllable_unit:lookup</code>.
  It is also covered by e.g. <code>manage:data</code> and <code>use:data:controllable_unit</code>.</p>
</li>
</ul>
<h3 id="party-type-check">Party type check</h3>
<p>The party type check is what is says the tin. It checks that the party type
doing the request is allowed to do the action on the resource. This is an
additional check added on just a few routes.</p>
<h3 id="field-level-authorization-fla">Field Level Authorization (FLA)</h3>
<p>We are basing FLA on an "authorization matrix". It is a table that shows which
actions are allowed for each party type on each resource field. The matrix shows
what each party type or anonymous users can do on each of the fields of the resource.</p>
<p>An example of an authorization matrix is shown below. This table shows that the
<code>id</code> field of resource <code>entity</code> is readable by all. The <code>name</code> field is
readable by all and can be updated and created by the <code>Service Provider</code>.
The <code>number</code> field of resource <code>invoice</code> can be created and read by
<code>Service Provider</code>, and read by <code>End User</code>, but <code>System Operator</code> cannot
interact with this field at all.</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Field</th>
<th>Service Provider</th>
<th>System Operator</th>
<th>End User</th>
</tr>
</thead>
<tbody>
<tr>
<td>entity</td>
<td>id</td>
<td>R</td>
<td>R</td>
<td>R</td>
</tr>
<tr>
<td>entity</td>
<td>name</td>
<td>CRU</td>
<td>R</td>
<td>R</td>
</tr>
<tr>
<td>invoice</td>
<td>number</td>
<td>RC</td>
<td></td>
<td>R</td>
</tr>
</tbody>
</table>
<p>The permission matrix is displayed as a markdown table in the give resources
docs page.</p>
<p>History resources inherit the authorizations from the main resource.</p>
<h3 id="resource-level-authorization-rla">Resource Level Authorization (RLA)</h3>
<p>Resource level authorization is a way to control access to each resource as a
whole. As an example, a service provider should only be able to see the
controllable units that are assigned to them.</p>
<p>RLA is documented as a set of policies per resource and party type. We document this
as a list of textual policies per type, as shown for Service Provider (SP) and
System Operator (SO) in the example below.</p>
<table>
<thead>
<tr>
<th>Policy key</th>
<th>Policy</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>CU-SP001</td>
<td>Read CU where they are SP. Only for the contract period.</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>CU-SP002</td>
<td>Create new CU.</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>CU-SP003</td>
<td>Update CU where they are current SP.</td>
<td>PARTIAL</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Policy key</th>
<th>Policy</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>CU-SO001</td>
<td>Read and update CU that are connected to AP belonging to SO.</td>
<td>PARTIAL</td>
</tr>
</tbody>
</table>
<p>We name the policies in the format
<code>&lt;Resource&gt;-&lt;Party Type Abbreviation&gt;&lt;Number&gt;</code>. The number is just used as a key
during discussions and serves as a way for us to document in the code what
policy is being implemented. It is also handy for code search.</p>
<p>Status can be one of:</p>
<ul>
<li><code>PROPOSED</code> means that the policy is proposed but not decided.</li>
<li><code>TODO</code> means that the policy is not implemented yet.</li>
<li><code>PARTIAL</code> means that the policy is partially implemented.</li>
<li><code>DONE</code> means that the policy is fully implemented.</li>
</ul>
<p>Policies can be in <code>TODO</code> or <code>PARTIAL</code> state either if we have not gotten to it
yet or the current platform does not support it (e.g. we are missing a
relation/entity).</p>
<h4 id="time-dependent-rla">Time-dependent RLA</h4>
<p>Some combinations of party type and resource have time-dependent access
policies.
In such cases, instead of controlling access in a binary way (the user can or
cannot see the resource based on some condition), access is <em>partially</em> given,
on the part of the timeline where the user has the required contract.
This means that we need to make sure that <em>no stateful operations</em> happening
outside of the allowed partial timeline are visible to the user.
This includes, for instance:</p>
<ul>
<li><em>former versions</em> of records erased before the start of the allowed timeline;</li>
<li><em>newer versions</em> of records introduced after the end of the allowed timeline;</li>
<li>records <em>deleted</em> before the start of the allowed timeline;</li>
<li><em>new</em> records created after the end of the allowed timeline.</li>
</ul>
<p>A typical example is the service provider (SP) on a controllable unit
(CU). The SPs contract on the CU is time-dependent, with a valid from and to
date. This in turn means that the SP should only have update privileges to the
CU during the contract period, but should see the CU even after the contract has
ended. However, an old SP should not be able to see updates to the CU fields
done by a new SP, after their contract has ended.</p>
<p>Several strategies are in use to implement such constraints, simplifications
being possible in some cases depending on which operations are available on the
resource.</p>
<h5 id="method-1-latest-visible-record">Method 1: Latest visible record</h5>
<p>When fields on the resource are <em>not</em> time-dependent, we must use audit history
to provide access when doing <em>read</em> operations on the main collection/resource.
This means that we authorize data stored with record time based on the valid
time.
Access policies are implemented on both the main resource and its history table.
The history view exposed in the API makes a union of both, so we can see all
present and past records, all filtered by the policies we want on the resource.</p>
<p>Then, we can pick from this collection based on <em>time</em>.
For instance, we can see which records were active at a given time in the past
by filtering the <em>record time</em> on each line.</p>
<p>The simplest filtering rule we can use is to just pick the
<em>latest visible record</em>.
This ensures that a user who can read the current records will see them instead
of historic values, and that conversely, if they cannot see the new ones, they
will see historic values presented as current records.</p>
<p>Let us take the example of the controllable unit resource where access for
service providers is based on CUSP contracts.</p>
<p><img alt="Time-dependent RLA" src="../../diagrams/time_dependent_authorization.png" /></p>
<p>In this example we have 3 records in the data history for the CU. <code>3</code> is the
current record. Two service providers, <code>A</code> and <code>B</code>, have had contracts on the
CU. <code>B</code> is the current SP. Each of the service providers will see the latest
record that <em>overlaps with the end date on their latest contract</em>.</p>
<p>So, when each of the service providers does a <code>GET /controllable_unit/{id}</code> they
will see different records.</p>
<ul>
<li><code>A</code> will see record <code>2</code>.</li>
<li><code>B</code> will see record <code>3</code>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Delete operation</p>
<p>A drawback of this method is that it does not handle <em>deleted</em> records well.
Indeed, on resources with history enabled, when records are deleted, they
are removed from the main table but kept in the history table.</p>
<p>This means that the <em>latest visible version</em> filtering method takes the
version of the record right before deletion and shows it in the main
resource, instead of not showing it at all.</p>
<p>Therefore, the current method cannot be used for resources supporting a
delete operation.</p>
</div>
<h5 id="method-2-as-of-query">Method 2: <em>As-of</em> query</h5>
<p>For resources that can be deleted, we introduce a more advanced mechanism.
Instead of taking the latest visible version of each record, we take all visible
records and only keep those that were <em>active at a certain date</em>, this date
being the latest point in the past where the user had a contract authorising
read access on the resource.
We call it the <em>as-of timestamp</em>, because conceptually this turns queries to
the resource into queries <em>as of</em> this specific timestamp.</p>
<p>Let us take the example of a resource managed in turn by 4 users: D, A, B, C,
and then D again.</p>
<p><img alt="asof_example" src="../../diagrams/asof_example.png" /></p>
<p>The resource has 3 records.
The first one is updated (marked by a colour change), then deleted while B
manages the resource; the second one is updated by A; the last one is created by
B and never updated.</p>
<p>We suppose the current date is 2020-07-09, midnight (marked with a change of
background color).</p>
<p>We need a definition for the as-of timestamp.
Let us take the timeline with all contracts for a given user.
Then we can define the as-of timestamp as the latest past point of this
timeline, <em>i.e.</em>:</p>
<div class="highlight"><pre><span></span><code>min(max(contract_timeline), now)
</code></pre></div>
<p>This means that this date is the end of A's contract for A, and this timestamp
is just <em>now</em> for all others (C and D having contracts in the future).
Both timestamps are marked with a dotted line.</p>
<p>This means that a query from A will give only 2 records, as R3 was not created
when A stopped being in charge.
Moreover, it will give R1 in its former state, because the update also happened
after their contract came to an end.</p>
<p>However, a query from one of the other users will give the latest state, <em>i.e.</em>,
only R2 and R3, with R2 in its latest version.</p>
<p>It is possible to change or refine the definition of the as-of timestamp as
needed.
For instance, if future contracts (like the ones of C and D) are too far in the
future, it may be judged unfair to show the current data of the resource.
The current example is simplified by taking contracts that are very close to
each other in time.</p>
<h2 id="user-creation-and-access-control-management">User creation and access control management</h2>
<p>To illustrate the auth model (<em>i.e.</em>, how entities, parties, scopes, <em>etc.</em>,
interact with each other), we explain in this section how a organisation is
modelelled in the system and how access is autonomously managed by its
employees.</p>
<p>The following diagram shows the end result of how an example organisation and
its employees are represented in the system.</p>
<p><img alt="Organisation access control management illustration" src="../../diagrams/organisation_management.drawio.png" /></p>
<p>The four black boxes shows how the oranisation itself is modelled in the system.</p>
<ul>
<li>An organisation <em>entity</em> representing the organisation</li>
<li>An organisation <em>party</em> for administrating the organisation in the system</li>
<li>Two parties with the right market roles so that the organisation can perform
  the business operations that they need in the FIS</li>
</ul>
<p>All parties are registered as owned by the organization.</p>
<p>The blue and green boxes are persons. Kari is an organisation admin and can
add/remove users to the parties that the organisation owns. Ola, Diana and Tor
are regular users with varying access to read and manage data on behalf of the
two market parties.</p>
<h3 id="autonomous-access-control-management">Autonomous access control management</h3>
<p>One person, in this case Kari, is registered as a admin member of the
organisation party by the FIS operator. Once Kari is granted
administrator privileges on the organisation, she can add and manage access
control for her colleagues without involving the FISO.</p>
<p>What we refer to as <em>administrator privileges</em> here is a certain set of scopes
on the party membership that makes the employee's person entity a member of the
organisation party.
The administrator is in charge for the addition of new users and the edition of
party memberships and entity clients.
The "administrator scopes" are therefore the ones sufficient to allow such
operations, <em>i.e.</em>, the following ones:</p>
<ul>
<li><code>manage:auth</code> - required for assuming/unassuming a party</li>
<li><code>read:data</code> - required for instance to access readable parties</li>
<li><code>use:data:entity:lookup</code> - to retrieve/create a technical identifier for the
  colleagues they want to add in the system</li>
<li><code>manage:data:party_memberships</code> - to add/remove their colleagues from the
  organisation's parties</li>
<li><code>manage:data:entity_client</code> - to manage clients on the organisation and set up
  machine access for their colleagues</li>
</ul>
<p>From the moment an entity is added to the organisation party with administrator
scopes, that person can log in and:</p>
<ul>
<li>Retrieve or create entities associated to their colleagues based on their
  person number through entity lookup.</li>
<li>Add/remove these entities to/from the various parties the organisation owns in
  the system.</li>
<li>Add/remove entity clients allowing applications to act as the organisation
  itself for some machine-automated operations.</li>
</ul>
<p>The administrator can also tune the scopes for both party memberships and
entity clients, to allow for precise access control management.
For instance, they can allow a data analyst in their company to <em>read</em> all the
data, but <em>not edit</em> it, because such authorisations are not needed and
restricting by default reduces the risk of making a mistake.</p>
<h3 id="sequence-of-actions">Sequence of actions</h3>
<p>Let us show an example of sequence of actions in the system to perform such an
autonomous access control management. In this example, FIS operator adds Kari as
admin and Kari adds Ola as a regular user for the Energy Supplier party.</p>
<p><img alt="Organisation access control management sequence" src="../../diagrams/org_access_control_management.png" /></p>
<h2 id="user-information-endpoint">User information endpoint</h2>
<p>OIDC provides a way to get user information. This is done by calling the
<code>/userinfo</code> endpoint with the access token. The response is a JSON object
with a set of claims about the user.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>